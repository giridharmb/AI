%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '14px'}, 'flowchart': {'nodeSpacing': 50, 'rankSpacing': 50}}}%%
graph LR

   subgraph UI["Slack Interface"]
       A[End User]
       B[Slack Client]
       C[API Gateway]
       A --> |1| B
       B --> |2| C
   end

   C --> |3| D

   subgraph APP["Application Layer"]
       D[Bot Server]
       E[Request Handler] 
       N[Response Processor]
       D --> |4| E
       N --> |12| D
   end

   subgraph DATA["Data Layer"]
       F[Data Orchestrator]
       G[GCS Client]
       H[BigQuery Client]
       I[Cloud Storage]
       J[BigQuery]
       E --> |5| F
       F --> |6a| G
       F --> |6b| H
       G --> |7a| I
       H --> |7b| J
   end

   subgraph AI["AI Layer"]
       K[Prompt Engineering]
       L[Gemini Client]
       M[Gemini API]
       E --> |8| K
       K --> |9| L
       L <--> |10| M
       L --> |11| N
   end

   D --> |13| C

   style UI fill:#f0f0ff,stroke:#333
   style APP fill:#f0fff0,stroke:#333 
   style DATA fill:#fff0f0,stroke:#333
   style AI fill:#f0fff0,stroke:#333